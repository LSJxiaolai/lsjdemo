
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>个人注册</title>
    <link href="~/Content/bootstrap-3.3.7-dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/jquery.bsgrid-1.37/css/skins/grid_bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/jquery.bsgrid-1.37/css/style.css" rel="stylesheet" />
    <style>
        .tuot {
            background-color: #74abd4;
               /*-webkit- google*/  
            background: -webkit-linear-gradient(top,#86b6dc 0,#8ab5d5 30%,#72a7d1 50%,#68a6d5 100%);
              /*-moz- 火狐*/
            background: -moz-linear-gradient(top,#86b6dc 0,#8ab5d5 30%,#72a7d1 50%,#68a6d5 100%);
              /*-o- OPERA*/
            background: -o-linear-gradient(top,#86b6dc 0,#8ab5d5 30%,#72a7d1 50%,#68a6d5 100%);
            background: linear-gradient(top,#86b6dc 0,#8ab5d5 30%,#72a7d1 50%,#68a6d5 100%);
            background-repeat: repeat-x;
           /*IE*/
            filter: progid:DXImageTransform.Microsoft.gradient(startColorstr=#86b6dc,endColorstr=#68a6d5,GradientType=0);
        }

        #FormBaoCun input,#FormBaoCun select{
            height:38px;
        }
        #FormBaoCun label{
            padding:9px;
        }
    </style>
</head>
<body>
    <div class="container" id="rowNot">
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 tuot" style="height:50px;">
                <h4 style="color:white"><i class="glyphicon glyphicon-plus-sign" style="color:green"></i>用户注册</h4>
            </div>
        </div>
        <div class="row" style="height:700px;border:2px solid #e1edee">
            <div class="col-md-12 col-sm-12" style="height:700px;background-color:#e5f6e2">
                <form class="form-horizontal" id="FormBaoCun" action="/Main/InsertUser">
                    <div class="form-group" style="margin-top:20px;">
                        <label class="control-label col-md-4 reset-padding" style="font-weight:lighter;"><i style="color:red">*</i>用户名</label>
                        <div class="col-md-4">
                            <input type="text" class="form-control" id="Usernames" name="Username" />
                        </div>
                        <h5 style="color:darkgray">用户名为系统登录用户名，请使用字符、数字等有效字符</h5>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-4 reset-padding" style="font-weight:lighter;"><i style="color:red">*</i>姓名</label>
                        <div class="col-md-4">
                            <input type="text" class="form-control" id="Name" name="Name" onkeyup="value=value.replace(/[^\u4E00-\u9FA5]/g,'')"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-4 reset-padding fontcolor" style="font-weight:lighter;"><i style="color:red">*</i>性别</label>
                        <div class="col-md-4">
                            <select class="form-control" id="XLSex" name="SexID"></select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-4 reset-padding" style="font-weight:lighter;"><i style="color:red">*</i>登录密码</label>
                        <div class="col-md-4">
                            <input type="password" class="form-control" id="RegisterCodes" name="RegisterCode" />
                        </div>
                        <h5 style="color:darkgray">密码由6-30位英文字母、数字和特殊字符组成，请使用强度较高的密码</h5>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-4 reset-padding" style="font-weight:lighter;"><i style="color:red">*</i>确认密码</label>
                        <div class="col-md-4">
                            <input type="password" class="form-control" id="AffirmCode" name="AffirmCode" />
                        </div>
                        <h5 style="color:darkgray">请再填写一遍密码</h5>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-4 reset-padding" style="font-weight:lighter;"><i style="color:red">*</i>身份证号</label>
                        <div class="col-md-4">
                            <input type="text" class="form-control" id="IdentityCode" name="IdentityCode" maxlength="18" onkeyup="value=value.replace(/[^0-9xX]/g,'')" onchange="IDentiFication(this.value)" />
                        </div>
                        <h5 style="color:darkgray">请认真核对您的证件号码，证件号码一经提交不能修改</h5>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-4 reset-padding" style="font-weight:lighter;"><i style="color:red">*</i>手机</label>
                        <div class="col-md-4">
                            @*<input type="text" class="form-control" id="PhoneCode" name="PhoneCode" maxlength="11" placeholder="请输入您的手机号码" onKeyUp="value=value.replace(/\D/g,'')" onafterpaste="value=value.replace(/\D/g,'')" />*@

                            <input type="text" class="form-control" id="PhoneCode" name="PhoneCode" aria-describedby="inputSuccess2Status" maxlength="11">
                            <span class="glyphicon glyphicon-ok form-control-feedback hidden" aria-hidden="true"></span>
                            <span id="PhoneCode" class="sr-only">(success)</span>
                            <span class="glyphicon glyphicon-remove form-control-feedback hidden" aria-hidden="false"></span>
                            <span id="PhoneCode" class="sr-only">(error)</span>
                            @*只能输入数字*@
                        </div>
                        <h5 style="color:darkgray">请输入11位手机号码，仅支持大陆地区手机号</h5>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-4 reset-padding" style="font-weight:lighter;"><i style="color:red">*</i>邮箱</label>
                        <div class="col-md-4">
                            <input type="text" class="form-control" id="Mailbox" name="Mailbox" maxlength="17" placeholder="1156162316@qq.com" />
                        </div>
                        <h5 style="color:darkgray">请输入正确的可使用的邮箱</h5>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-4 reset-padding fontcolor" style="font-weight:lighter;"><i style="color:red">*</i>密码问题</label>
                        <div class="col-md-4">
                            <select class="form-control" id="XLMiMaWT" name="AnswerID"></select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-4 reset-padding" style="font-weight:lighter;"><i style="color:red">*</i>密码答案</label>
                        <div class="col-md-4">
                            <input type="text" class="form-control" id="CodeAnswer" name="CodeAnswer" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label no-padding-right" for="validCode" style="font-weight:lighter;">
                            <i style="color:red">*</i>验证码
                        </label>
                        <div class="col-sm-4">
                            <div class="input-group">
                                <input type="text" name="VerifyCode" id="validCodes" value="" class="form-control" />
                                <div class="input-group-addon" style="padding:0"><img src="/Main/ValideCode" id="ZCValidateCode" onclick="ZCreloadImage()" /></div>
                            </div>
                        </div>
                    </div>
                </form>
                <div class="text-center" style="height:50px;margin-top:20px;">
                    <button class="btn btn-info" id="btnTiJiao" style="background-color:#dfeffc;color:#34759b;font-weight:bold;width:80px;">注 册<span class="glyphicon glyphicon-arrow-right"></span></button>
                    <button class="btn btn-info" id="btnZhuCeFH" style="background-color:#dfeffc;color:#34759b;font-weight:bold;width:80px;">返 回<span class="glyphicon glyphicon-share-alt"></span></button>
                </div>
            </div>
        </div>
    </div>

    <!--注册成功跳转窗体-->
    <div class="container hidden" id="rowSet" style="height:340px;border:5px solid #e1edee;padding:0px;margin-top:100px;">
        <!--窗体头部行-->
        <div class="col-lg-12 col-md-12 col-sm-12 tuot"style="height:50px;">
            <h4 style="font-weight:bold; color:white;"><i class="glyphicon glyphicon-user" style="color:green;"></i>个人用户登录</h4>
        </div>
        <!--用户登录显示行-->
        <div class="col-lg-12 col-md-12 col-sm-12" style="height:100px;padding:0px;background-color:#b1b1b1;">
            <h3 id="ZCsuccess" class="text-center" style="color:green;font-weight:bold;margin-top:40px;"></h3>
        </div>
        <!--按钮行-->
        <div class="col-lg-12 col-md-12 col-sm-12" style="background-color:#b1b1b1;">
            <div class="text-center">
                <div class="col-lg-12 col-md-12 col-sm-12" style="margin-top:20px; height:40px;">
                    <button type="button" class="btn btn-info" style="width:150px;background-color:#dfeffc;color:#34759b;font-weight:bold;" id="btnZCShenBao">职称申报</button>
                </div>
                <div class="col-lg-12 col-md-12 col-sm-12" style="margin-top:20px; height:40px;">
                    <button type="button" class="btn btn-info" style="width:150px;background-color:#dfeffc;color:#34759b;font-weight:bold;" id="btnYHXX">用户信息</button>
                </div>
                <div class="col-lg-12 col-md-12 col-sm-12" style="margin-top:20px; height:40px;">
                    <button type="button" class="btn btn-info" style="width:150px;background-color:#dfeffc;color:#34759b;font-weight:bold;" id="btnTuiChu">去登录</button>
                </div>
            </div>
        </div>
    </div>
    <!--注册成功跳转窗体-->
    <script src="~/Content/bootstrap-3.3.7-dist/js/jquery-1.11.2.min.js"></script>
    <script src="~/Content/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
    <script src="~/Content/jquery.bsgrid-1.37/js/lang/grid.zh-CN.min.js"></script>
    <script src="~/Content/jquery.bsgrid-1.37/merged/bsgrid.all.min.js"></script>
    <script src="~/Content/js/jquery.form.js"></script>
    <script src="~/Content/js/customfunction.js"></script>
    <script src="~/Content/layer/layer.js"></script>
    <script>
        //下拉框
        $(function () {
            createSelect("XLSex", "/Main/SelectSex");//ZC性别
            createSelect("XLMiMaWT", "/Main/SelectMiMaWT");//ZC密码问题
        });

        //用户注册提交
        $("#btnTiJiao").click(function () {
            var Username = $('#FormBaoCun [name="Username"]').val();//用户名
            var Name = $('#FormBaoCun [name="Name"]').val();//姓名
            var XLSex = $('#FormBaoCun [name="SexID"]').val();//性别
            var RegisterCode = $('#FormBaoCun [name="RegisterCode"]').val();//登录密码
            var AffirmCode = $('#FormBaoCun [name="AffirmCode"]').val();//确认密码
            var IdentityCode = $('#FormBaoCun [name="IdentityCode"]').val();//身份证号
            var PhoneCode = $('#FormBaoCun [name="PhoneCode"]').val();//手机
            var Mailbox = $('#FormBaoCun [name="Mailbox"]').val();//邮箱
            var XLMiMaWT = $('#FormBaoCun [name="AnswerID"]').val();//密码问题
            var CodeAnswer = $('#FormBaoCun [name="CodeAnswer"]').val();//密码答案
            var VerifyCode = $('#FormBaoCun [name="VerifyCode"]').val();//验证码
            if (XLSex > 0 && XLMiMaWT > 0 && Username != '' && Name != '' && RegisterCode != '' && AffirmCode != '' &&
                IdentityCode != '' && PhoneCode   != '' && CodeAnswer != '' && VerifyCode != '') {
                var layerIndex = layer.load(0);//显示 加载层
                //提交表单
                $("#FormBaoCun").ajaxSubmit(function (msg) {
                    layer.close(layerIndex);//关闭 加载层   
                    if (msg == "success") {
                        $("#rowNot").addClass("hidden");
                        $("#rowSet").removeClass("hidden");
                        $("#ZCsuccess").html("温馨提示：" + "" + Name + " " + "你好！" + "你已注册成功！！！");
                        //layer.alert("注册成功!!!", { title: '提示' });                        
                    } else {
                        layer.alert('注册失败', { icon: 0, title: '提示' });
                    }
                    $("#modInsertExaminee").modal("hide");//关闭 modal 
                });
            } else {
                layer.alert('信息还没填写完整，不可以提交哦', { icon: 0, title: '提示' });
            }
        });//新增用户

        //用户返回按钮
        $("#btnZhuCeFH").click(function () {
            window.close("/Main/UserRegister");//关闭用户注册页面
        });

        //注册页面验证码刷新
        function ZCreloadImage() {
            $("#ZCValidateCode").attr("src", '/Main/ValideCode?ts=' + new Date().getTime());
        }

        //个人注册手机号正则验证
        $("#PhoneCode").blur(function () {
            if ((/^1[34578]\d{9}$/).test($("#PhoneCode").val())) {
                layer.alert("输入正确", { icon: 1 });
                $('#PhoneCode').css("border-color", "green");                
                Mobile_Boolean = true;
            } else {
                layer.alert("请输入正确的手机号码", { icon: 2 });
                $('#PhoneCode').css("border-color", "red");
                Mobile_Boolean = false;              
            }
        })

        //邮箱正则验证
        $('#FormBaoCun [name="Mailbox"]').change(function () {
            var Email = $('#FormBaoCun [name="Mailbox"]').val();
            $.post("/Main/RegularMailbox", { Email: Email }, function (msg) {
                if (msg == false) {
                    layer.alert("输入邮箱不正确", { icon: 0 });
                    //$('#FormBaoCun [name="Mailbox"]').val("");
                } else {
                    layer.alert("输入正确", { icon: 1 });
                }
            });
        });

        //身份证验证
        function IDentiFication(num) {
            num = num.toUpperCase();           //身份证号码为15位或者18位，15位时全为数字，18位前17位为数字，最后一位是校验位，可能为数字或字符X。
            if (!(/(^\d{15}$)|(^\d{17}([0-9]|X)$)/.test(num))) {
                //alert('输入的身份证号长度不对，或者号码不符合规定！\n15位号码应全为数字，18位号码末位可以为数字或X。');
                alert('身份证号长度不正确或不符合规定！');
                return false;
            }
            //验证前2位，城市符合
            var aCity = {
                11: "北京", 12: "天津", 13: "河北", 14: "山西", 15: "内蒙古", 21: "辽宁", 22: "吉林", 23: "黑龙江 ", 31: "上海", 32: "江苏", 33: "浙江", 34: "安徽",
                35: "福建", 36: "江西", 37: "山东", 41: "河南", 42: "湖北", 43: "湖南", 44: "广东", 45: "广西", 46: "海南", 50: "重庆", 51: "四川", 52: "贵州",
                53: "云南", 54: "西藏", 61: "陕西", 62: "甘肃", 63: "青海", 64: "宁夏", 65: "新疆", 71: "台湾", 81: "香港", 82: "澳门", 91: "国外"
            };
            if (aCity[parseInt(num.substr(0, 2))] == null) {
                alert('身份证号不正确或不符合规定！');
                return false;
            }
            //alert('城市:'+aCity[parseInt(num.substr(0,2))]);

            //下面分别分析出生日期和校验位
            var len, re; len = num.length;
            if (len == 15) {
                re = new RegExp(/^(\d{6})(\d{2})(\d{2})(\d{2})(\d{3})$/);
                var arrSplit = num.match(re);  //检查生日日期是否正确
                var dtmBirth = new Date('19' + arrSplit[2] + '/' + arrSplit[3] + '/' + arrSplit[4]);
                var bGoodDay; bGoodDay = (dtmBirth.getYear() == Number(arrSplit[2])) && ((dtmBirth.getMonth() + 1) == Number(arrSplit[3])) && (dtmBirth.getDate() == Number(arrSplit[4]));
                if (!bGoodDay) {
                    alert('身份证号的出生日期不对！');
                    return false;
                } else { //将15位身份证转成18位 //校验位按照ISO 7064:1983.MOD 11-2的规定生成，X可以认为是数字10。
                    var arrInt = new Array(7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2);
                    var arrCh = new Array('1', '0', 'X', '9', '8', '7', '6', '5', '4', '3', '2');
                    var nTemp = 0, i;
                    num = num.substr(0, 6) + '19' + num.substr(6, num.length - 6);
                    for (i = 0; i < 17; i++) {
                        nTemp += num.substr(i, 1) * arrInt[i];
                    }
                    num += arrCh[nTemp % 11];
                    return true;
                }
            }
            if (len == 18) {
                re = new RegExp(/^(\d{6})(\d{4})(\d{2})(\d{2})(\d{3})([0-9]|X)$/);
                var arrSplit = num.match(re);  //检查生日日期是否正确
                var dtmBirth = new Date(arrSplit[2] + "/" + arrSplit[3] + "/" + arrSplit[4]);
                var bGoodDay; bGoodDay = (dtmBirth.getFullYear() == Number(arrSplit[2])) && ((dtmBirth.getMonth() + 1) == Number(arrSplit[3])) && (dtmBirth.getDate() == Number(arrSplit[4]));
                if (!bGoodDay) {
                    //alert(dtmBirth.getYear());
                    //alert(arrSplit[2]);
                    alert('身份证号的出生日期不对！');
                    return false;
                }
                else { //检验18位身份证的校验码是否正确。 //校验位按照ISO 7064:1983.MOD 11-2的规定生成，X可以认为是数字10。
                    var valnum;
                    var arrInt = new Array(7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2);
                    var arrCh = new Array('1', '0', 'X', '9', '8', '7', '6', '5', '4', '3', '2');
                    var nTemp = 0, i;
                    for (i = 0; i < 17; i++) {
                        nTemp += num.substr(i, 1) * arrInt[i];
                    }
                    valnum = arrCh[nTemp % 11];
                    if (valnum != num.substr(17, 1)) {
                        //alert('18位身份证的校验码不正确！应该为：' + valnum);
                        alert('18位身份证号的校验码不正确！');
                        return false;
                    }
                    return true;
                }
            } return false;

        }

        //职称申报按钮
        $("#btnZCShenBao").click(function () {
            alert("您还没登录哦，还不能进入职称申报，赶紧去登录吧！");
        });

        //用户信息按钮
        $("#btnYHXX").click(function () {
            $("#rowSet").addClass("hidden");
            $("#rowNot").removeClass("hidden");
        });

        //去登录按钮
        $("#btnTuiChu").click(function () {
            window.close("/Main/UserRegister");
        });
    </script>
</body>
</html>
